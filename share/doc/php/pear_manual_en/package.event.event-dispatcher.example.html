<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
  <title>Examples</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
  <meta name="generator" content="PhD" />

  <link rel="start" href="index.html" title="PEAR Manual" />
  <link rel="up" href="package.event.event-dispatcher.html" title="Event_Dispatcher" />
  <link rel="prev" href="package.event.event-dispatcher.intro.html" title="Introduction" />
  <link rel="next" href="package.event.event-dispatcher.event-dispatcher.getinstance.html" title="Event_Dispatcher::getInstance" />
 </head>
 <body>
<div class="navheader">
 <table style="width: 100%;">
  <tr><th colspan="3" style="text-align: center">Examples</th></tr>
  <tr>
   <td style="width: 40%; text-align: left;"><a href="package.event.event-dispatcher.intro.html" title="Introduction">Prev</a></td>
   <td style="width: 20%;"></td>
   <td style="width: 40%; text-align: right;"><a href="package.event.event-dispatcher.event-dispatcher.getinstance.html" title="Event_Dispatcher::getInstance">Next</a></td>
  </tr>
 </table>
 <hr/>
</div>
<div id="body">
<div class="refentry" id="package.event.event-dispatcher.example">
 
  <h1 class="refname">Examples</h1>
  <div class="refnamediv">Examples &ndash; Examples for the usage of Event_Dispatcher</div>

 

 <div class="refsection" id="package.event.event-dispatcher.example.example1"><div class="info"><h1>Examples usage of Event_Dispatcher</h1>
</div>
  
  <p class="simpara">
    The following examples show you how to use Event_Dispatcher to
    create more flexible applications.
  </p>
  <div class="example"><div class="info"><p><strong>Basic example</strong></p></div>
   
   <div class="phpcode">
    <code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">require_once&nbsp;</span><span style="color: #DD0000">'Event/Dispatcher.php'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br /></span><span style="color: #FF8000">/**<br />&nbsp;*&nbsp;Dummy&nbsp;class&nbsp;that&nbsp;simulated&nbsp;authentication<br />&nbsp;*/<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Auth<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;</span><span style="color: #0000BB">$_dispatcher&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;</span><span style="color: #0000BB">$_user</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">Auth</span><span style="color: #007700">(&amp;</span><span style="color: #0000BB">$dispatcher</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_dispatcher&nbsp;</span><span style="color: #007700">=&nbsp;&amp;</span><span style="color: #0000BB">$dispatcher</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">login</span><span style="color: #007700">(</span><span style="color: #0000BB">$username</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$password</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Your&nbsp;code&nbsp;that&nbsp;authenticates&nbsp;goes&nbsp;here<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;....<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;imagine&nbsp;$this-&gt;_user&nbsp;contains&nbsp;a&nbsp;User&nbsp;object<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_dispatcher</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">post</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_user</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'onLogin'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">logAuth</span><span style="color: #007700">(&amp;</span><span style="color: #0000BB">$notification</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;&amp;</span><span style="color: #0000BB">$notification</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getNotificationObject</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$username&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getUsername</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;write&nbsp;logfile<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">error_log</span><span style="color: #007700">(</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$username</span><span style="color: #DD0000">&nbsp;logged&nbsp;in."</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'/tmp/auth.log'</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$dispatcher&nbsp;</span><span style="color: #007700">=&nbsp;&amp;</span><span style="color: #0000BB">Event_Dispatcher</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;catch&nbsp;all&nbsp;onLogin&nbsp;events&nbsp;to&nbsp;write&nbsp;a&nbsp;logfile<br /></span><span style="color: #0000BB">$dispatcher</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addObserver</span><span style="color: #007700">(</span><span style="color: #DD0000">'logAuth'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'onLogin'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$auth&nbsp;</span><span style="color: #007700">=&nbsp;&amp;new&nbsp;</span><span style="color: #0000BB">Auth</span><span style="color: #007700">(</span><span style="color: #0000BB">$dispatcher</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;simulate&nbsp;login<br /></span><span style="color: #0000BB">$auth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">login</span><span style="color: #007700">(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'pass'</span><span style="color: #007700">]);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code>
   </div>
   <div class="example-contents"><p>
    In this example, <strong class="classname">Event_Dispatcher</strong> is used to
    allow observers to hook into the authentication process. Whenever a 
    user authenticates, a notification <em class="emphasis">onLogin</em> is
    sent.
   </p></div>
   <div class="example-contents"><p>
    This can be used to write logfiles or block the application for
    other users.
   </p></div>
  </div>

  <div class="example"><div class="info"><p><strong>Cancelling notifications</strong></p></div>
   
   <div class="phpcode">
    <code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">require_once&nbsp;</span><span style="color: #DD0000">'Event/Dispatcher.php'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br /></span><span style="color: #FF8000">/**<br />&nbsp;*&nbsp;Dummy&nbsp;class&nbsp;that&nbsp;simulated&nbsp;authentication<br />&nbsp;*/<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Auth<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;</span><span style="color: #0000BB">$_dispatcher&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;</span><span style="color: #0000BB">$_user</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">Auth</span><span style="color: #007700">(&amp;</span><span style="color: #0000BB">$dispatcher</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_dispatcher&nbsp;</span><span style="color: #007700">=&nbsp;&amp;</span><span style="color: #0000BB">$dispatcher</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">login</span><span style="color: #007700">(</span><span style="color: #0000BB">$username</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$password</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Your&nbsp;code&nbsp;that&nbsp;authenticates&nbsp;goes&nbsp;here<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;....<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;imagine&nbsp;$this-&gt;_user&nbsp;contains&nbsp;a&nbsp;User&nbsp;object<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$notification&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_dispatcher</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">post</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_user</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'onLogin'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$notification</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">isNotificationCancelled</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"You&nbsp;are&nbsp;not&nbsp;allowed&nbsp;to&nbsp;login"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logout</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">logAuth</span><span style="color: #007700">(&amp;</span><span style="color: #0000BB">$notification</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;&amp;</span><span style="color: #0000BB">$notification</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getNotificationObject</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$username&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getUsername</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;If&nbsp;a&nbsp;special&nbsp;user&nbsp;authenticated,&nbsp;cancel<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;notification<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$username&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #DD0000">'foo'</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$notification</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">cancelNotification</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;write&nbsp;logfile<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">error_log</span><span style="color: #007700">(</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$username</span><span style="color: #DD0000">&nbsp;logged&nbsp;in."</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'/tmp/auth.log'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br /></span><span style="color: #0000BB">$dispatcher&nbsp;</span><span style="color: #007700">=&nbsp;&amp;</span><span style="color: #0000BB">Event_Dispatcher</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;catch&nbsp;all&nbsp;onLogin&nbsp;events&nbsp;to&nbsp;write&nbsp;a&nbsp;logfile<br /></span><span style="color: #0000BB">$dispatcher</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addObserver</span><span style="color: #007700">(</span><span style="color: #DD0000">'logAuth'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'onLogin'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$auth&nbsp;</span><span style="color: #007700">=&nbsp;&amp;new&nbsp;</span><span style="color: #0000BB">Auth</span><span style="color: #007700">(</span><span style="color: #0000BB">$dispatcher</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;simulate&nbsp;login<br /></span><span style="color: #0000BB">$auth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">login</span><span style="color: #007700">(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'pass'</span><span style="color: #007700">]);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code>
   </div>
   <div class="example-contents"><p>
    In this case, the <strong class="function">cancelNotification()</strong> method is
    used to cancel the notification if a certain user tries to
    authenticate.
   </p></div>
   <div class="example-contents"><p>
    The login method has been changed as well to check whether the notification
    has been cancelled and to take the necessary steps.
   </p></div>
   <div class="example-contents"><p>
    This allows you to add some flexible rules to your authentication system.
   </p></div>
  </div>
 </div>

</div>
</div>
<div class="navfooter">
 <hr />
 <table style="width: 100%;">
  <tr>
   <td style="width: 40%; text-align: left;"><a accesskey="p" href="package.event.event-dispatcher.intro.html">Prev</a></td>
   <td style="width: 20%; text-align: center;"><a accesskey="h" href="package.event.event-dispatcher.html">Event_Dispatcher</a></td>
   <td style="width: 40%; text-align: right;"><a accesskey="n" href="package.event.event-dispatcher.event-dispatcher.getinstance.html">Next</a></td>
  </tr>
  <tr>
   <td style="text-align: left; vertical-align: top;">Introduction</td>
   <td style="text-align: center;"><a accesskey="h" href="index.html">PEAR Manual</a></td>
   <td style="text-align: right; vertical-align: top;">Event_Dispatcher::getInstance</td>
  </tr>
 </table>
</div>
</body></html>
