<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
  <title>Introduction</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
  <meta name="generator" content="PhD" />

  <link rel="start" href="index.html" title="PEAR Manual" />
  <link rel="up" href="package.authentication.auth.html" title="Auth" />
  <link rel="prev" href="package.authentication.auth.html" title="Auth" />
  <link rel="next" href="package.authentication.auth.intro-options.html" title="Auth Options" />
 </head>
 <body>
<div class="navheader">
 <table style="width: 100%;">
  <tr><th colspan="3" style="text-align: center">Introduction</th></tr>
  <tr>
   <td style="width: 40%; text-align: left;"><a href="package.authentication.auth.html" title="Auth">Prev</a></td>
   <td style="width: 20%;"></td>
   <td style="width: 40%; text-align: right;"><a href="package.authentication.auth.intro-options.html" title="Auth Options">Next</a></td>
  </tr>
 </table>
 <hr/>
</div>
<div id="body">
<div class="refentry" id="package.authentication.auth.intro">
 
  <h1 class="refname">Introduction</h1>
  <div class="refnamediv">Introduction &ndash; A usage example</div>

 
 <div class="refsection" id="package.authentication.auth.intro.example"><div class="info"><h1>Auth tutorial</h1>
</div> 
  
  <p class="simpara">
   Our goal during this &quot;mini tutorial&quot; is to set up a system that
   secures your site with an easy to use authentication mechanism.
  </p>
  <p class="para">
   At the top of the site to secure, place the following code snippet:
  </p>
  <div class="example"><div class="info"><p><strong>Typical usage example for <strong class="classname">PEAR::Auth</strong></strong></p></div>
   
   <div class="phpcode">
    <code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">require_once&nbsp;</span><span style="color: #DD0000">"Auth.php"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Takes&nbsp;three&nbsp;arguments:&nbsp;last&nbsp;attempted&nbsp;username,&nbsp;the&nbsp;authorization<br />//&nbsp;status,&nbsp;and&nbsp;the&nbsp;Auth&nbsp;object.&nbsp;<br />//&nbsp;We&nbsp;won't&nbsp;use&nbsp;them&nbsp;in&nbsp;this&nbsp;simple&nbsp;demonstration&nbsp;--&nbsp;but&nbsp;you&nbsp;can&nbsp;use&nbsp;them<br />//&nbsp;to&nbsp;do&nbsp;neat&nbsp;things.<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">loginFunction</span><span style="color: #007700">(</span><span style="color: #0000BB">$username&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$status&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,&nbsp;&amp;</span><span style="color: #0000BB">$auth&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Change&nbsp;the&nbsp;HTML&nbsp;output&nbsp;so&nbsp;that&nbsp;it&nbsp;fits&nbsp;to&nbsp;your<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;application.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"&lt;form&nbsp;method=\"post\"&nbsp;action=\"test.php\"&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;input&nbsp;type=\"text\"&nbsp;name=\"username\"&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;input&nbsp;type=\"password\"&nbsp;name=\"password\"&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;input&nbsp;type=\"submit\"&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;/form&gt;"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">$options&nbsp;</span><span style="color: #007700">=&nbsp;array(<br />&nbsp;&nbsp;</span><span style="color: #DD0000">'dsn'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"mysql://user:password@localhost/database"</span><span style="color: #007700">,<br />&nbsp;&nbsp;);<br /></span><span style="color: #0000BB">$a&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Auth</span><span style="color: #007700">(</span><span style="color: #DD0000">"DB"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$options</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"loginFunction"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$a</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">start</span><span style="color: #007700">();<br /><br />if&nbsp;(</span><span style="color: #0000BB">$a</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">checkAuth</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;output&nbsp;of&nbsp;your&nbsp;site&nbsp;goes&nbsp;here.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br /></span><span style="color: #007700">}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code>
   </div>
   <div class="example-contents"><p>
    This few lines of code instantiate the authentication system.
   </p></div>
   <div class="example-contents"><p>
    The first line in the above script includes the file from your
    PEAR directory. It contains all the necessary code to run
    <strong class="classname">PEAR::Auth</strong>. Next, we define a function
    to display the login form which the visitor of your page has to
    use to enter his login data. You can change all the <span class="acronym">HTML</span>
    formatting in this function.
   </p></div>
   <div class="example-contents"><p>
    
   </p></div>
   <div class="example-contents"><p>
    Since we want to use a database to verify the login data, we now
    create the variable <code class="varname">$dsn</code>, it contains a valid
    DSN string that will be used to connect to the database via
    <a href="package.database.db.html" class="link">PEAR::DB</a>. For the default
    database table schema or to use a different storage container,
    please see below for more information.
   </p></div>
   <div class="example-contents"><p>
    After that we create the authentication object. The first
    parameter defines the name of the storage container. Because we
    want to use a database driven storage container, we pass &quot;DB&quot;
    here. The second parameter is the connection parameter for the
    container driver. We use the previously defined DSN string. The
    third parameter is the name of our function that we defined at the
    beginning of the script. It prints the login form.
   </p></div>
   <div class="example-contents"><p>
    Now our authentication object is initialized and we need to check
    if the user is logged in. This is done via the method
    <strong class="function">checkAuth()</strong>. If it returns <strong class="constant">TRUE</strong>, we can pass the
    content of our page to the user.
   </p></div>

  </div>
  <div class="example"><div class="info"><p><strong>Using optional authentication</strong></p></div>
   
   <div class="phpcode">
    <code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;In&nbsp;this&nbsp;test,&nbsp;the&nbsp;file&nbsp;is&nbsp;named&nbsp;"test.php".<br /><br /></span><span style="color: #007700">require_once&nbsp;</span><span style="color: #DD0000">"Auth.php"</span><span style="color: #007700">;<br /><br />function&nbsp;</span><span style="color: #0000BB">loginFunction</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Change&nbsp;the&nbsp;HTML&nbsp;output&nbsp;so&nbsp;that&nbsp;it&nbsp;fits&nbsp;to&nbsp;your<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;application.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"&lt;form&nbsp;method=\"post\"&nbsp;action=\"test.php?login=1\"&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;input&nbsp;type=\"text\"&nbsp;name=\"username\"&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;input&nbsp;type=\"password\"&nbsp;name=\"password\"&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;input&nbsp;type=\"submit\"&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;/form&gt;"</span><span style="color: #007700">;<br />}<br /><br />if&nbsp;(isset(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'login'</span><span style="color: #007700">])&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'login'</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$optional&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$optional&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">$options&nbsp;</span><span style="color: #007700">=&nbsp;array(<br />&nbsp;&nbsp;</span><span style="color: #DD0000">'dsn'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"mysql://user:password@localhost/database"</span><span style="color: #007700">,<br />&nbsp;&nbsp;);<br /></span><span style="color: #0000BB">$a&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Auth</span><span style="color: #007700">(</span><span style="color: #DD0000">"DB"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$options</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"loginFunction"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$optional</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$a</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">start</span><span style="color: #007700">();<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Everybody&nbsp;can&nbsp;see&nbsp;this&nbsp;text!&lt;br&nbsp;/&gt;"</span><span style="color: #007700">;<br /><br />if&nbsp;(!isset(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'login'</span><span style="color: #007700">]))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;a&nbsp;href=\"test.php?login=1\"&gt;Click&nbsp;here&nbsp;to&nbsp;log&nbsp;in&lt;/a&gt;\n"</span><span style="color: #007700">;<br />}<br /><br />if&nbsp;(</span><span style="color: #0000BB">$a</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getAuth</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"One&nbsp;can&nbsp;only&nbsp;see&nbsp;this&nbsp;if&nbsp;he&nbsp;is&nbsp;logged&nbsp;in!"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code>
   </div>
   <div class="example-contents"><p>
    This is a pretty nice example for the optional login feature: The
    last parameter <em><code class="parameter">$optional</code></em> can be either <strong class="constant">TRUE</strong>
    or <strong class="constant">FALSE</strong>. If it is <strong class="constant">FALSE</strong>, the login form is not shown and the user
    only sees the text &quot;Everybody can see this text!&quot;. If he clicks on
    the link above this text, he gets the same page but with the GET
    parameter &quot;login=1&quot;. Now he can enter his login information in the
    login form. If he successfully logs in, he can then see the text
    &quot;Everybody can see this text!&quot; and the text &quot;One can only see this
    if he is logged in!&quot;.
   </p></div>
  </div>

  <div class="example"><div class="info"><p><strong>Logout functionality</strong></p></div>
   
   <div class="example-contents"><p>
    The following example performs a "<span class="quote">logout</span>" for the
    current user and displays the login form again.
   </p></div>
   <div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$myauth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">start</span><span style="color: #007700">();<br />if&nbsp;(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'action'</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #DD0000">"logout"&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;</span><span style="color: #0000BB">$myauth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">checkAuth</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$myauth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logout</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$myauth</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">start</span><span style="color: #007700">();<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

  <p class="para">
   In the following passages we cover more detailed information about
   the functions of <strong class="classname">PEAR::Auth</strong>.
  </p>
  <p class="para">
   This SQL statement creates a table usable under the default
   database authentication scheme using MySQL:
  </p>
  <div class="sqlcode"><pre class="sqlcode">
CREATE TABLE auth (
   username VARCHAR(50) default &#039;&#039; NOT NULL,
   password VARCHAR(32) default &#039;&#039; NOT NULL,
   PRIMARY KEY (username),
   KEY (password)
);</pre>
</div>
  <p class="para">
   These are the table and field names necessary for working
   authentication. When hashing the passwords with the MD5 algorithm,
   which is the default encryption method in
   <strong class="classname">PEAR::Auth</strong>, the password column must be at
   least 32 characters long.  When using another encryption method like
   <span class="acronym">DES</span> ("<span class="quote">UNIX
   <strong class="command">crypt</strong></span>"), the column size has to be changed
   correspondingly.
  </p>
 </div>
</div>
</div>
<div class="navfooter">
 <hr />
 <table style="width: 100%;">
  <tr>
   <td style="width: 40%; text-align: left;"><a accesskey="p" href="package.authentication.auth.html">Prev</a></td>
   <td style="width: 20%; text-align: center;"><a accesskey="h" href="package.authentication.auth.html">Auth</a></td>
   <td style="width: 40%; text-align: right;"><a accesskey="n" href="package.authentication.auth.intro-options.html">Next</a></td>
  </tr>
  <tr>
   <td style="text-align: left; vertical-align: top;">Auth</td>
   <td style="text-align: center;"><a accesskey="h" href="index.html">PEAR Manual</a></td>
   <td style="text-align: right; vertical-align: top;">Auth Options</td>
  </tr>
 </table>
</div>
</body></html>
