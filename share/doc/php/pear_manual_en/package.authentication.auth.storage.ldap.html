<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
  <title>Auth_Container_LDAP</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
  <meta name="generator" content="PhD" />

  <link rel="start" href="index.html" title="PEAR Manual" />
  <link rel="up" href="package.authentication.auth.html" title="Auth" />
  <link rel="prev" href="package.authentication.auth.storage.kadm5.html" title="Auth_Container_KADM5" />
  <link rel="next" href="package.authentication.auth.storage.mdb.html" title="Auth_Container_MDB" />
 </head>
 <body>
<div class="navheader">
 <table style="width: 100%;">
  <tr><th colspan="3" style="text-align: center">Auth_Container_LDAP</th></tr>
  <tr>
   <td style="width: 40%; text-align: left;"><a href="package.authentication.auth.storage.kadm5.html" title="Auth_Container_KADM5">Prev</a></td>
   <td style="width: 20%;"></td>
   <td style="width: 40%; text-align: right;"><a href="package.authentication.auth.storage.mdb.html" title="Auth_Container_MDB">Next</a></td>
  </tr>
 </table>
 <hr/>
</div>
<div id="body">
<div class="refentry" id="package.authentication.auth.storage.ldap">
 
  <h1 class="refname">Auth_Container_LDAP</h1>
  <div class="refnamediv">Auth_Container_LDAP &ndash; Authenticate against an LDAP server</div>

 
 <div class="refsection" id="package.authentication.auth.storage.ldap.overview"><div class="info"><h1>LDAP Container</h1>
</div>
  
  <p class="para">
   This storage container makes use of the ldap extension to load user data
   from an LDAP server.
  </p>
  <p class="para">
   The storage-specific argument for the 
   <a href="package.authentication.auth.auth.auth.html" class="link">
    <strong class="function">Auth constructor()</strong>
   </a>
   is an array of options.
   </p><table class="doctable table"><caption>Available Options</caption>
    
    
     <thead>
      <tr>
       <th>Option</th>
       <th>Data Type</th>
       <th>Default value</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>
        "<span class="quote">host</span>"
       </td>
       <td>
        <span class="type">string</span>
       </td>
       <td>
        "<span class="quote">localhost</span>"
       </td>
       <td>
        The host name or IP-adress to access
       </td>
      </tr>

      <tr>
       <td>
        "<span class="quote">port</span>"
       </td>
       <td>
        <span class="type">integer</span>
       </td>
       <td>
        389
       </td>         
       <td>
        The port of the LDAP server to access
       </td>
      </tr>
               
      <tr>
       <td>
        "<span class="quote">url</span>"
       </td>
       <td>
        <span class="type">string</span>
       </td>
       <td>
        "<span class="quote">
       </td>
       <td>
        A fully qualified URL for specifying the protocol, url and port to
        connect to. It is useful for specifying ldaps://. Takes precedence
        over "<span class="quote">host</span>" and "<span class="quote">port</span>" options. Only works
        if PHP has been compiled against OpenLDAP 2+ libraries.
       </td>
      </tr>
       
      <tr>
       <td>
        "<span class="quote">version</span>"
       </td>
       <td>
        <span class="type">integer</span>
       </td>
       <td>
        2
       </td>
       <td>
        LDAP version to use, usually 2 (default) or 3, must be an integer!
       </td>
      </tr>
 
      <tr>
       <td>
        "<span class="quote">referrals</span>"
       </td>
       <td>
        <span class="type">boolean</span>
       </td>
       <td>
        <strong class="constant">TRUE</strong>
       </td>
       <td>
        If set, determines whether the LDAP library automatically follows 
        referrals returned by LDAP servers or not.
       </td>
      </tr>
       
      <tr>
       <td>
        "<span class="quote">binddn</span>"
       </td>
       <td>
        <span class="type">string</span>
       </td>
       <td>
        "<span class="quote">
       </td>
       <td>
        If set, searching for user will be done after binding as this user, 
        if not set the bind will be anonymous. This is reported to make the
        container work with MS Active Directory, but should work with any
        server that is configured this way. This has to be a complete dn for
        now (basedn and userdn will not be appended).
       </td>
      </tr>

      <tr>
       <td>
        "<span class="quote">bindpw</span>"
       </td>
       <td>
        <span class="type">string</span>
       </td>
       <td>
        "<span class="quote">
       </td>
       <td>
        The password to use for binding with binddn.
       </td>
      </tr>

      <tr>
       <td>
        "<span class="quote">basedn</span>"
       </td>
       <td>
        <span class="type">string</span>
       </td>
       <td>
        "<span class="quote">
       </td>         
       <td>
        The base DN of your server. 
       </td>
      </tr>
                       
      <tr>
       <td>
        "<span class="quote">userdn</span>"
       </td>
       <td>
        <span class="type">string</span>
       </td>
       <td>
        "<span class="quote">
       </td>
       <td>
        Gets prepended to basedn when searching for users.
       </td>
      </tr>

      <tr>
       <td>
        "<span class="quote">userscope</span>"
       </td>
       <td>
        <span class="type">string</span>
       </td>
       <td>
        "<span class="quote">sub</span>"
       </td>
       <td>
        Scope for user searching: one, sub (default), or base.
       </td>
      </tr>

      <tr>
       <td>
        "<span class="quote">userattr</span>"
       </td>
       <td>
        <span class="type">string</span>
       </td>
       <td>
        "<span class="quote">uid</span>"
       </td>
       <td>
        Defines the attribute to search for.
       </td>
      </tr>

      <tr>
       <td>
        "<span class="quote">userfilter</span>"
       </td>
       <td>
        <span class="type">string</span>
       </td>
       <td>
        "<span class="quote">(objectClass=posixAccount)</span>"
       </td>
       <td>
        Filter that will be added to the search filter this way:
        (&amp;(userattr=username)(userfilter)).
       </td>
      </tr>

      <tr>
       <td>
        "<span class="quote">attributes</span>"
       </td>
       <td>
        <span class="type">array</span>
       </td>
       <td>
        array(&#039;&#039;)
       </td>
       <td>
        Array of additional attributes to fetch from entry. These will added
        to auth data and can be retrieved via 
        <a href="package.authentication.auth.auth.getauth.html" class="link">
         <strong class="classname">Auth</strong>::<strong class="function">getAuthData()</strong>
        </a>. An empty array will fetch all attributes, array(&#039;&#039;) will
        fetch no attributes at all (default). If you add &#039;dn&#039; as a value to
        this array, the user&#039;s DN that was used for binding will be added to
        auth data as well.
       </td>
      </tr>

      <tr>
       <td>
        "<span class="quote">attrformat</span>"
       </td>
       <td>
        <span class="type">string</span>
       </td>
       <td>
        "<span class="quote">AUTH</span>"
       </td>
       <td>
        <p class="para">
         The returned format of the additional data defined in the &#039;attributes&#039;
         option. Two formats are available.
        </p>
        <p class="para">
         LDAP returns data formatted in a multidimensional array where each
         array starts with a &#039;count&#039; element providing the number of attributes
         in the entry, or the number of values for attributes. When set to this
         format, the only way to retrieve data from the
         <strong class="classname">Auth</strong> object is by calling
         getAuthData(&#039;attributes&#039;). This was the default
         format before version 1.3.0.
        </p>
        <p class="para">
         AUTH returns data formatted in a structure more compliant with other
         Auth Containers, where each attribute element can be directly called
         by <strong class="function">getAuthData()</strong> method from
         <strong class="classname">Auth</strong>. This became the default as of 1.3.0.
        </p>
       </td>
      </tr>

      <tr>
       <td>
        "<span class="quote">groupdn</span>"
       </td>
       <td>
        <span class="type">string</span>
       </td>
       <td>
        "<span class="quote">
       </td>
       <td>
        Gets prepended to basedn when searching for group.
       </td>
      </tr>

      <tr>
       <td>
        "<span class="quote">groupattr</span>"
       </td>
       <td>
        <span class="type">string</span>
       </td>
       <td>
        "<span class="quote">cn</span>"
       </td>
       <td>
        The group attribute to search for.
       </td>
      </tr>

      <tr>
       <td>
        "<span class="quote">groupfilter</span>"
       </td>
       <td>
        <span class="type">string</span>
       </td>
       <td>
        "<span class="quote">(objectClass=groupOfUniqueNames)</span>"
       </td>
       <td>
        Filter that will be added to the search filter when searching for a
        group: (&amp;(groupattr=group)(memberattr=username)(groupfilter)).
       </td>
      </tr>

      <tr>
       <td>
        "<span class="quote">memberattr</span>"
       </td>
       <td>
        <span class="type">string</span>
       </td>
       <td>
        "<span class="quote">uniqueMember</span>"
       </td>
       <td>
        The attribute of the group object where the user dn may be found.
       </td>
      </tr>

      <tr>
       <td>
        "<span class="quote">memberisdn</span>"
       </td>
       <td>
        <span class="type">boolean</span>
       </td>
       <td>
        <strong class="constant">TRUE</strong>
       </td>
       <td>
        Whether the memberattr is the dn of the user (default) or the value of
        userattr (usually uid).
       </td>
      </tr>

      <tr>
       <td>
        "<span class="quote">group</span>"
       </td>
       <td>
        <span class="type">string</span>
       </td>
       <td>
        "<span class="quote">
       </td>
       <td>
        The name of the group users have to be a member of to authenticate
        successfully.
       </td>
      </tr>

      <tr>
       <td>
        "<span class="quote">groupscope</span>"
       </td>
       <td>
        <span class="type">string</span>
       </td>
       <td>
        "<span class="quote">sub</span>"
       </td>
       <td>
        Scope for group searching: one, sub (default), or base.
       </td>
      </tr>

      <tr>
       <td>
        "<span class="quote">start_tls</span>"
       </td>
       <td>
        <span class="type">boolean</span>
       </td>
       <td>
        "<span class="quote">false</span>"
       </td>
       <td>
        Enable/disable the use of START_TLS encrypted connection.
       </td>
      </tr>

      <tr>
       <td>
        "<span class="quote">try_all</span>"
       </td>
       <td>
        <span class="type">boolean</span>
       </td>
       <td>
        <strong class="constant">FALSE</strong>
       </td>
       <td>
        If multiple entries are returned by the search attempt to authenticate
        against each entry in order or just the first one (default).
       </td>
      </tr>

      <tr>
       <td>
        "<span class="quote">debug</span>"
       </td>
       <td>
        <span class="type">boolean</span>
       </td>
       <td>
        <strong class="constant">FALSE</strong>
       </td>
       <td>
        Enable debug output.
       </td>
      </tr>

     </tbody>
    
   </table>

  
  <div class="example"><div class="info"><p><strong>Authenticating against a LDAP server</strong></p></div>
   
   <div class="phpcode">
    <code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$a1&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Auth</span><span style="color: #007700">(</span><span style="color: #DD0000">"LDAP"</span><span style="color: #007700">,&nbsp;array(<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'host'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'port'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'389'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'version'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'basedn'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'o=netsols,c=de'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'userattr'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'uid'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'binddn'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'cn=admin,o=netsols,c=de'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'bindpw'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'password'<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code>
   </div>
  </div>
  <div class="example"><div class="info"><p><strong>Requiring users to be within specific groups</strong></p></div>
   
   <div class="phpcode">
    <code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$a2&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Auth</span><span style="color: #007700">(</span><span style="color: #DD0000">'LDAP'</span><span style="color: #007700">,&nbsp;array(<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'url'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'ldaps://ldap.netsols.de'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'basedn'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'o=netsols,c=de'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'userscope'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'one'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'userdn'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'ou=People'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'groupdn'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'ou=Groups'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'groupfilter'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'(objectClass=posixGroup)'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'memberattr'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'memberUid'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'memberisdn'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'group'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'admin'<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code>
   </div>
  </div>
  <div class="example"><div class="info"><p><strong>Authenticating against a Microsoft Active Directory server</strong></p></div>
   
   <div class="phpcode">
    <code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$a3&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Auth</span><span style="color: #007700">(</span><span style="color: #DD0000">'LDAP'</span><span style="color: #007700">,&nbsp;array(<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'host'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'ldap.netsols.de'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'port'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">389</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'version'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'referrals'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'basedn'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'dc=netsols,dc=de'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'binddn'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'cn=Jan&nbsp;Wagner,cn=Users,dc=netsols,dc=de'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'bindpw'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'password'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'userattr'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'samAccountName'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'userfilter'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'(objectClass=user)'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'attributes'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #DD0000">''</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'group'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'testing'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'groupattr'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'samAccountName'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'groupfilter'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'(objectClass=group)'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'memberattr'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'member'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'memberisdn'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'groupdn'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'cn=Users'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'groupscope'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'one'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code>
   </div>
  </div>
  <p class="para">
   When talking to a Microsoft ActiveDirectory server you have to use
   &#039;samaccountname&#039; as the &#039;userattr&#039; and follow special rules to translate
   the ActiveDirectory directory names into &#039;basedn&#039;. The &#039;basedn&#039; for the
   default &#039;Users&#039; folder on an ActiveDirectory server for the ActiveDirectory
   Domain (which is not related to its DNS name) &quot;win2000.example.org&quot; would
   be: &quot;CN=Users, DC=win2000, DC=example, DC=org&quot; where every component of the
   domain name becomes a DC attribute of its own. If you want to use a custom
   users folder you have to replace &quot;CN=Users&quot; with a sequence of &quot;OU&quot;
   attributes that specify the path to your custom folder in reverse order. So
   the ActiveDirectory folder &quot;win2000.example.org\Custom\Accounts&quot; would
   become &quot;OU=Accounts, OU=Custom, DC=win2000, DC=example, DC=org&quot;
  </p>
  <p class="para">
   It seems that binding anonymously to an Active Directory is not allowed, so
   you have to set binddn and bindpw for user searching.
  </p>
  <p class="para">
   LDAP Referrals need to be set to false for AD to work sometimes.
  </p>
  <p class="para">
   Note also that if you want an encrypted connection to an MS LDAP server,
   then, on your webserver, you must specify "<span class="quote">TLS_REQCERT never</span>"
   in /etc/ldap/ldap.conf or in the webserver user&#039;s ~/.ldaprc (which may or
   may not be read depending on your configuration).
  </p>
 </div>
</div>
</div>
<div class="navfooter">
 <hr />
 <table style="width: 100%;">
  <tr>
   <td style="width: 40%; text-align: left;"><a accesskey="p" href="package.authentication.auth.storage.kadm5.html">Prev</a></td>
   <td style="width: 20%; text-align: center;"><a accesskey="h" href="package.authentication.auth.html">Auth</a></td>
   <td style="width: 40%; text-align: right;"><a accesskey="n" href="package.authentication.auth.storage.mdb.html">Next</a></td>
  </tr>
  <tr>
   <td style="text-align: left; vertical-align: top;">Auth_Container_KADM5</td>
   <td style="text-align: center;"><a accesskey="h" href="index.html">PEAR Manual</a></td>
   <td style="text-align: right; vertical-align: top;">Auth_Container_MDB</td>
  </tr>
 </table>
</div>
</body></html>
