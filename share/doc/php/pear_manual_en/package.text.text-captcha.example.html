<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
  <title>Example</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
  <meta name="generator" content="PhD" />

  <link rel="start" href="index.html" title="PEAR Manual" />
  <link rel="up" href="package.text.text-captcha.html" title="Text_CAPTCHA" />
  <link rel="prev" href="package.text.text-captcha.intro.html" title="Introduction" />
  <link rel="next" href="package.text.text-captcha.information.html" title="Information about the CAPTCHA and inner workings" />
 </head>
 <body>
<div class="navheader">
 <table style="width: 100%;">
  <tr><th colspan="3" style="text-align: center">Example</th></tr>
  <tr>
   <td style="width: 40%; text-align: left;"><a href="package.text.text-captcha.intro.html" title="Introduction">Prev</a></td>
   <td style="width: 20%;"></td>
   <td style="width: 40%; text-align: right;"><a href="package.text.text-captcha.information.html" title="Information about the CAPTCHA and inner workings">Next</a></td>
  </tr>
 </table>
 <hr/>
</div>
<div id="body">
<div class="section" id="package.text.text-captcha.example"><div class="info"><h1>Example</h1>
</div>
  

  <p class="para">
    The following example implements the standard use of a CAPTCHA:
    Submitted form data is only evaluated when a CAPTCHA has been
    solved correctly. 
  </p>

  <div class="example" id="package.text.text-captcha.example.create"><div class="info"><p><strong>Creating a CAPTCHA</strong></p></div>
    

    <div class="example-contents"><p>
      The following code creates a CAPTCHA, provides the relevant
      information for the package, anhd retrieves the CAPTCHA as a 
      PNG image.
    </p></div>

    <div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">require_once&nbsp;</span><span style="color: #DD0000">'Text/CAPTCHA.php'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Set&nbsp;CAPTCHA&nbsp;options&nbsp;(font&nbsp;must&nbsp;exist!)<br /></span><span style="color: #0000BB">$imageOptions&nbsp;</span><span style="color: #007700">=&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'font_size'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">24</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'font_path'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'./'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'font_file'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'COUR.TTF'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'text_color'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'#DDFF99'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'lines_color'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'#CCEEDD'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'background_color'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'#555555'<br /></span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Set&nbsp;CAPTCHA&nbsp;options<br /></span><span style="color: #0000BB">$options&nbsp;</span><span style="color: #007700">=&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'width'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">200</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'height'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">80</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'output'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'png'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'imageOptions'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$imageOptions<br /></span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /></span><span style="color: #FF8000">//&nbsp;Generate&nbsp;a&nbsp;new&nbsp;Text_CAPTCHA&nbsp;object,&nbsp;Image&nbsp;driver<br /></span><span style="color: #0000BB">$c&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Text_CAPTCHA</span><span style="color: #007700">::</span><span style="color: #0000BB">factory</span><span style="color: #007700">(</span><span style="color: #DD0000">'Image'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$retval&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$c</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">init</span><span style="color: #007700">(</span><span style="color: #0000BB">$options</span><span style="color: #007700">);<br />if&nbsp;(</span><span style="color: #0000BB">PEAR</span><span style="color: #007700">::</span><span style="color: #0000BB">isError</span><span style="color: #007700">(</span><span style="color: #0000BB">$retval</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">'Error&nbsp;initializing&nbsp;CAPTCHA:&nbsp;%s!'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$retval</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;exit;<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;Get&nbsp;CAPTCHA&nbsp;secret&nbsp;passphrase<br /></span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'phrase'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$c</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getPhrase</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;Get&nbsp;CAPTCHA&nbsp;image&nbsp;(as&nbsp;PNG)<br /></span><span style="color: #0000BB">$png&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$c</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getCAPTCHAAsPNG</span><span style="color: #007700">();<br />if&nbsp;(</span><span style="color: #0000BB">PEAR</span><span style="color: #007700">::</span><span style="color: #0000BB">isError</span><span style="color: #007700">(</span><span style="color: #0000BB">$png</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'Error&nbsp;generating&nbsp;CAPTCHA!'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$png</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;exit;<br />}<br /></span><span style="color: #0000BB">file_put_contents</span><span style="color: #007700">(</span><span style="color: #0000BB">md5</span><span style="color: #007700">(</span><span style="color: #0000BB">session_id</span><span style="color: #007700">())&nbsp;.&nbsp;</span><span style="color: #DD0000">'.png'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$png</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

  <div class="example" id="package.text.text-captcha.example.secure"><div class="info"><p><strong>Securing a form with a CAPTCHA</strong></p></div>
    

    <div class="example-contents"><p>
      The following code implements the functionality to check whether
      a CAPTCHA was solved correctly or not. for this, the
      CAPTCHA&#039;s phrase is stored in a session variable to
      retain this information between requests. It is
      important to unset the session after solving the 
      CAPTCHA to avoid the reuse of the session ID.
    </p></div>

    <div class="phpcode">
      <code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />session_start</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$ok&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$msg&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Please&nbsp;enter&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;image&nbsp;in&nbsp;the&nbsp;field&nbsp;below!'</span><span style="color: #007700">;<br />if&nbsp;(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'REQUEST_METHOD'</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #DD0000">'POST'</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'phrase'</span><span style="color: #007700">])&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">is_string</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'phrase'</span><span style="color: #007700">])&nbsp;&amp;&amp;&nbsp;isset(</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'phrase'</span><span style="color: #007700">])&nbsp;&amp;&amp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'phrase'</span><span style="color: #007700">])&nbsp;&gt;&nbsp;</span><span style="color: #0000BB">0&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'phrase'</span><span style="color: #007700">])&nbsp;&gt;&nbsp;</span><span style="color: #0000BB">0&nbsp;</span><span style="color: #007700">&amp;&amp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'phrase'</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'phrase'</span><span style="color: #007700">])&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$msg&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'OK!'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ok&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unset(</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">'phrase'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$msg&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Please&nbsp;try&nbsp;again!'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">unlink</span><span style="color: #007700">(</span><span style="color: #0000BB">md5</span><span style="color: #007700">(</span><span style="color: #0000BB">session_id</span><span style="color: #007700">())&nbsp;.&nbsp;</span><span style="color: #DD0000">'.png'</span><span style="color: #007700">);<br />}<br />print&nbsp;</span><span style="color: #DD0000">"&lt;p&gt;</span><span style="color: #0000BB">$msg</span><span style="color: #DD0000">&lt;/p&gt;"</span><span style="color: #007700">;<br /><br />if&nbsp;(!</span><span style="color: #0000BB">$ok</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;create&nbsp;the&nbsp;CAPTCHA&nbsp;as&nbsp;seen&nbsp;above<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;and&nbsp;send&nbsp;it&nbsp;to&nbsp;the&nbsp;client<br /></span><span style="color: #007700">}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code>
    </div>
    <div class="example-contents"><p>See the file <code class="filename">CAPTCHA_test.php</code>
    in the package distribution for a full, working
    example (GD and TTF support required).</p></div>
  </div>
</div>
</div>
<div class="navfooter">
 <hr />
 <table style="width: 100%;">
  <tr>
   <td style="width: 40%; text-align: left;"><a accesskey="p" href="package.text.text-captcha.intro.html">Prev</a></td>
   <td style="width: 20%; text-align: center;"><a accesskey="h" href="package.text.text-captcha.html">Text_CAPTCHA</a></td>
   <td style="width: 40%; text-align: right;"><a accesskey="n" href="package.text.text-captcha.information.html">Next</a></td>
  </tr>
  <tr>
   <td style="text-align: left; vertical-align: top;">Introduction</td>
   <td style="text-align: center;"><a accesskey="h" href="index.html">PEAR Manual</a></td>
   <td style="text-align: right; vertical-align: top;">Information about the CAPTCHA and inner workings</td>
  </tr>
 </table>
</div>
</body></html>
