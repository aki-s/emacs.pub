<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
  <title>DB_Table_Generator Class Tutorial</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
  <meta name="generator" content="PhD" />

  <link rel="start" href="index.html" title="PEAR Manual" />
  <link rel="up" href="package.database.db-table.html" title="DB_Table" />
  <link rel="prev" href="package.database.db-table.intro-database.html" title="DB_Table_Database Class Tutorial" />
  <link rel="next" href="package.database.db-table.intro-datatypes.html" title="DB_Table Data Types" />
 </head>
 <body>
<div class="navheader">
 <table style="width: 100%;">
  <tr><th colspan="3" style="text-align: center">DB_Table_Generator Class Tutorial</th></tr>
  <tr>
   <td style="width: 40%; text-align: left;"><a href="package.database.db-table.intro-database.html" title="DB_Table_Database Class Tutorial">Prev</a></td>
   <td style="width: 20%;"></td>
   <td style="width: 40%; text-align: right;"><a href="package.database.db-table.intro-datatypes.html" title="DB_Table Data Types">Next</a></td>
  </tr>
 </table>
 <hr/>
</div>
<div id="body">
<div class="refentry" id="package.database.db-table.intro-generator">


  <h1 class="refname">
  <strong class="classname">DB_Table_Generator</strong> Class Tutorial
  </h1>
  <div class="refnamediv"><strong class="classname">DB_Table_Generator</strong>  Class Tutorial
   &ndash; 
  Code generation for an existing database
  </div>



<div class="refsection" id="package.database.db-table.intro-generator.desc">
<h1 class="title">Description</h1>
<p class="para"> 
The <strong class="classname">DB_Table_Generator</strong> class can generate the PHP 
code necessary to use the DB_Table package to interact with an existing 
database. It generates skeleton <strong class="classname">DB_Table</strong> 
subclass definitions for every table in the database, using table schemas 
that are obtained by querying the database. It can also generate a file 
containing the code required to connect to the database, and to create 
a parent <strong class="classname">DB_Table_Database</strong> object. 
</p>
</div>

<div class="refsection" id="package.database.db-table.intro-generator.names"><div class="info"><h1>Name Conventions and File Structure</h1>
</div>

<p class="para">
All code generated by a <strong class="classname">DB_Table_Generator</strong> object 
is written to a directory whose path is given by the $class_write_path 
property of that object. By default, this is the current directory. 
By default, the name of the class constructed for a table named 
&#039;thing&#039; is <strong class="classname">Thing_Table</strong>. That is, the 
class name is the table name, with the first letter upper case, with 
an added suffix &#039;_Table&#039;. This suffix can be changed by 
setting the $class_suffix property. The name of the file containing a 
subclass definition is the subclass name with a PHP extension, e.g., 
&#039;Thing_Table.php&#039;. The name of the object instantiated 
from that subclass is the same as the table  name, with no suffix, 
e.g., &#039;thing&#039;.
</p> 
</div>

<div class="refsection" id="package.database.db-table.intro-generator.generation"><div class="info"><h1>Code Generation Instructions</h1>
</div>

<p class="para">To generate the code for all of the tables in a database named 
$database, instantiate a <strong class="classname">DB</strong> or
<strong class="classname">MDB2</strong> object named $conn that connects 
to the database of interest, and execute the following code:  
</p>
<div class="example"><div class="info"><p><strong>Code Generation for an Entire Database</strong></p></div>

<div class="phpcode">
<code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">require_once&nbsp;</span><span style="color: #DD0000">'DB/Table/Generator.php'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;[snip]&nbsp;Instantiate&nbsp;DB&nbsp;or&nbsp;MDB2&nbsp;object&nbsp;$conn<br /><br />//&nbsp;Instantiate&nbsp;a&nbsp;Generator&nbsp;object&nbsp;<br /></span><span style="color: #0000BB">$generator&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">DB_Table_Generator</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$database</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Choose&nbsp;a&nbsp;directory&nbsp;for&nbsp;the&nbsp;generated&nbsp;code<br /></span><span style="color: #0000BB">$generator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">class_write_path&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'/var/www/html/app1/db_table'&nbsp;</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Generate&nbsp;DB_Table&nbsp;subclass&nbsp;definition&nbsp;files&nbsp;<br /></span><span style="color: #0000BB">$generator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">generateTableClassFiles</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;Generate&nbsp;the&nbsp;'Database.php'&nbsp;file<br /></span><span style="color: #0000BB">$generator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">generateDatabaseFile</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code> 
</div>  
</div>

<p class="para">
In the above example, &#039;/var/www/html/app1/db_table&#039; is the path 
(without a trailing directory separator) to a directory in which all 
of the code should be written.  If this directory does not exist, it 
will be created (if possible). If the directory does already exist, 
existing files will not be overwritten. If $class_write_path is not 
set (i.e., if this line from the example is ommitted) all the code 
will be written to the current  directory. 
</p>

<p class="para">
The <strong class="function">generateTableClassFiles()</strong> method generates 
skeleton subclass definitions for a set of tables, with different 
subclass definitions in different files. If it is called with no 
argument, as above, it generates subclass definitions for all of 
the tables in the current database.  
</p>

<p class="para"> 
The <strong class="function">generateDatabaseFile()</strong> method generates a 
file, named &#039;Database.php&#039; by default, that contains all 
of the additional code necessary to connect to a database and to 
create a parent <strong class="classname">DB_Table_Database</strong> object. 
If the <strong class="function">generateDatabaseFile()</strong> method is called, 
as in the above example, it must be  called after the
<strong class="function">generateTableClassFiles()</strong>. 
The code in the &#039;Database.php&#039; file includes (using the
&quot;require_once&quot; command) each of the table subclass definition files, 
instantiates one object of each <strong class="classname">DB_Table</strong> 
subclass (creating one object per table), instantiates a parent 
<strong class="classname">DB_Table_Database</strong> object, adds all the tables 
to that parent, and attempts to guess foreign key relationships 
between tables based on the column names.  This file will generally 
need to be edited so as to include information about the data 
source name (DSN), and any foreign key relationships that could 
not be guessed by the generator.
</p>

<p class="para">
By default, <strong class="function">generateTableClassFiles()</strong> and 
<strong class="function">generateDatabaseFiles()</strong> generate code for all of 
the tables in the current database. To generate code for a specified 
list of tables, set the value of the public $tables property to a 
sequential list of table names before calling either of these 
methods. For example, code can be generated for three tables named 
&#039;table1&#039;, &#039;table2&#039;, and &#039;table3&#039; as 
follows:  
</p>

<div class="example"><div class="info"><p><strong>Code Generation for a Specified Set of Tables</strong></p></div>

<div class="phpcode">
<code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">require_once&nbsp;</span><span style="color: #DD0000">'DB/Table/Generator.php'<br /><br /></span><span style="color: #FF8000">//&nbsp;[snip]&nbsp;Instantiate&nbsp;DB&nbsp;or&nbsp;MDB2&nbsp;object&nbsp;$conn<br /><br />//&nbsp;Instantiate&nbsp;a&nbsp;Generator&nbsp;object&nbsp;<br /></span><span style="color: #0000BB">$generator&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">DB_Table_Generator</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$database</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Choose&nbsp;a&nbsp;directory&nbsp;for&nbsp;the&nbsp;generated&nbsp;code<br /></span><span style="color: #0000BB">$generator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">class_write_path&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'/var/www/html/app1/db_table'&nbsp;</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Define&nbsp;the&nbsp;set&nbsp;of&nbsp;tables<br /></span><span style="color: #0000BB">$generator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">tables&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'table1'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'table2'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'table3'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Generate&nbsp;DB_Table&nbsp;subclass&nbsp;definition&nbsp;files&nbsp;<br /></span><span style="color: #0000BB">$generator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">generateTableClassFiles</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;Generate&nbsp;the&nbsp;'Database.php'&nbsp;file<br /></span><span style="color: #0000BB">$generator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">generateDatabaseFile</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code> 
</div>  
</div>

<p class="para">
If the $tables property of the DB_Table_Generator object is not set to an
array value before <strong class="function">generateTableClassFiles()</strong> is called,
then, by default, the <strong class="function">generateTableClassFiles()</strong> method
queries the database for an array of all table names (by calling the 
<strong class="function">getTableNames()</strong> method internally), and the $table 
property is set equal to the resulting array of table names.
</p>

</div>

</div>
</div>
<div class="navfooter">
 <hr />
 <table style="width: 100%;">
  <tr>
   <td style="width: 40%; text-align: left;"><a accesskey="p" href="package.database.db-table.intro-database.html">Prev</a></td>
   <td style="width: 20%; text-align: center;"><a accesskey="h" href="package.database.db-table.html">DB_Table</a></td>
   <td style="width: 40%; text-align: right;"><a accesskey="n" href="package.database.db-table.intro-datatypes.html">Next</a></td>
  </tr>
  <tr>
   <td style="text-align: left; vertical-align: top;">DB_Table_Database Class Tutorial</td>
   <td style="text-align: center;"><a accesskey="h" href="index.html">PEAR Manual</a></td>
   <td style="text-align: right; vertical-align: top;">DB_Table Data Types</td>
  </tr>
 </table>
</div>
</body></html>
